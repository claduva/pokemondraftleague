{% extends "template.html" %}
{% load static %}
{% load crispy_forms_tags %}
{% load extratags %}

{% block title %}{{league_name}}: {{team.teamname}}{% endblock %}
{% block head%}
{% endblock %}
{% block body %}

<div class="row text-light bg-darkgrey rounded align-items-center mb-2">
    <div class="col-4 d-flex justify-content-start"><img src="{{team.logo.url}}" class="rounded-circle mediumlogo">
    </div>
    <div class="col-4">
        <h3 class="text-center">{{ team.teamname }}</h3>
    </div>
    <div class="col-4 d-flex justify-content-end"><img src="{{team.logo.url}}" class="rounded-circle mediumlogo">
    </div>
    <div class="col-md-12">
    <div class="card table-responsive bg-lightgrey text-dark text-center overflow-auto mb-3">
        <table class="table table-sm table-bordered table-striped p-0 m-0 text-center">
            <tr class="bg-dark text-light">
                <th>Coach</th>
                <th>Wins</th>
                <th>Losses</th>
                <th>Differential</th>
                <th>Streak</th>
                {% if team.conference %}
                <th>Conference</th>
                {% endif %}
                {% if team.division %}
                <th>Division</th>
                {% endif %}
            </tr>
            <tr >
                <th>{{ team.coach }}{% if team.teammate %} and {{team.teammate}}{% endif %}</th>
                <th>{{ team.wins }}</th>
                <th>{{ team.losses }}</th>
                <th>{% if team.differential > 0 %}+{{ team.differential }}{% else %}{{ team.differential }}{% endif %}</th>
                <th>{% if team.streak > -1 %}Win-{{ team.streak }}{% else %}Lose{{ team.streak }}{% endif %}</th>
                {% if team.conference %}
                <th>{{ team.conference }}</th>
                {% endif %}
                {% if team.division %}
                <th>{{ team.division }}</th>
                {% endif %}
            </tr>
        </table>
        </div>
    </div>
</div>
<div class="row text-light bg-darkgrey rounded align-items-center mb-2">
    <div class="col-md-12">
        <h4>Roster</h4>
        <div class="card table-responsive bg-lightgrey text-dark text-center overflow-auto mb-3">
            <table class="table table-sm table-bordered table-striped p-0 m-0 text-center">
            <thead>
                <tr class="text-center bg-dark text-light">
                    <th class="p-0 m-0">Pokemon</th>
                    <th class="p-0 m-0">K</th>
                    <th class="p-0 m-0">D</th>
                    <th class="p-0 m-0">+/-</th>
                    <th class="p-0 m-0">GP</th>
                    <th class="p-0 m-0">GW</th>
                </tr>
            </thead>
            <tbody>
                {% for item in roster %}
                <tr class="bg-lightgrey text-dark text-center">
                    <td class="p-0 m-0">
                        {% if item.pokemon.pokemon %}
                        <div class="d-flex justify-content-center">
                            <img class="smallsprite"
                                src="{{item.pokemon.pokemon|sprite:site_settings.sprite}}">
                            <p>{{ item.pokemon.pokemon }}</p>
                            {% if item.zuser == 'OS' %}
                                <div><img class="smallsprite" src="{% static 'main/images/z-crystal.png' %}">(Offensive & Status)</div>
                            {% elif item.zuser == 'O' %}    
                                <div><img class="smallsprite" src="{% static 'main/images/z-crystal.png' %}">(Offensive)</div>
                            {% endif %}
                        </div>
                        {% else %}
                        <div>
                            <img class="smallsprite justify-content-center"
                                src="https://play.pokemonshowdown.com/sprites/{{ site_settings.sprite|split:0 }}/unown-question.{{ site_settings.sprite|split:1 }}">
                        </div>
                        {% endif %}
                    </td>
                    <td class="p-0 m-0">{{ item.kills }}</td>
                    <td class="p-0 m-0">{{ item.deaths }}</td>
                    <td class="p-0 m-0">{{ item.differential }}</td>
                    <td class="p-0 m-0">{{ item.gp }}</td>
                    <td class="p-0 m-0">{{ item.gw }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        </div>
    </div>
</div>
{% if upcoming %}
<div class="row bg-darkgrey text-light rounded p-2 mb-2">
    <div class="col-md-12">
        <h3>Upcoming Matches</h3>
        <div class="card table-responsive bg-lightgrey text-dark text-center overflow-auto mb-3">
            <table class="table table-sm table-bordered table-striped p-0 m-0 text-center">
                <tr class="bg-dark text-light">
                    <th>Week</th>
                    <th>Opponent</th>
                    <th>Due Date (UTC)</th>
                    <th>Links</th>
                </tr>
                {% for item in upcoming %}
                <tr>
                    <td class="align-middle">{{item.week}}</td>
                    <td>
                        {% if item.team1 == team %}
                        <a class="text-dark" href="{% url 'team_page' league_name=item.season.subleague.league.name subleague_name=item.season.subleague.subleague team_abbreviation=item.team2.teamabbreviation %}">
                        <div><img class="small-logo rounded-circle" src="{{ item.team2.logo.url }}"></div>
                        <div>{{item.team2.teamname}}</div>
                        </a>
                        {% elif item.team2 == team %}
                        <a class="text-dark" href="{% url 'team_page' league_name=item.season.subleague.league.name subleague_name=item.season.subleague.subleague team_abbreviation=item.team1.teamabbreviation %}">
                        <div><img class="small-logo rounded-circle" src="{{ item.team1.logo.url }}"></div>
                        <div>{{item.team1.teamname}}</div>
                        </a>
                        {% endif %}
                    </td>
                    <td>{{item.duedate}}</td>
                    <td class="align-middle">
                        <a class="text-dark"
                            href="{% url 'league_matchup' league_name=item.season.subleague.league.name subleague_name=item.season.subleague.subleague matchid=item.id %}">
                            <h6 class="text-center">View Matchup</h6>
                        </a>
                        <a class="text-dark"
                            href="{% url 'upload_league_replay' league_name=item.season.subleague.league.name subleague_name=item.season.subleague.subleague matchid=item.id %}">
                            <h6 class="text-center">Upload Replay</h6>
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </table>
        </div>
    </div>
</div>
{% endif %}
{% if results %}
<div class="row bg-darkgrey text-light rounded p-2 mb-2">
    <div class="col-md-12">
        <h3>Recent Results</h3>
        <div class="card table-responsive bg-lightgrey text-dark text-center overflow-auto mb-3">
            <table class="table table-sm table-bordered table-striped p-0 m-0 text-center">
                <tr class="bg-dark text-light">
                    <th>Week</th>
                    <th>Opponent</th>
                    <th>Result</th>
                </tr>
                {% for item in results %}
                <tr>
                    <td class="align-middle">{{item.week}}</td>
                    <td>
                        {% if item.team1 == team %}
                        <a class="text-dark" href="{% url 'team_page' league_name=item.season.subleague.league.name subleague_name=item.season.subleague.subleague team_abbreviation=item.team2.teamabbreviation %}">
                        <div><img class="small-logo rounded-circle" src="{{ item.team2.logo.url }}"></div>
                        <div>{{item.team2.teamname}}</div>
                        </a>
                        {% elif item.team2 == team %}
                        <a class="text-dark" href="{% url 'team_page' league_name=item.season.subleague.league.name subleague_name=item.season.subleague.subleague team_abbreviation=item.team1.teamabbreviation %}">
                        <div><img class="small-logo rounded-circle" src="{{ item.team1.logo.url }}"></div>
                        <div>{{item.team1.teamname}}</div>
                        </a>
                        {% endif %}
                    </td>
                    <td class="align-middle">
                        <a class="text-dark" href="{% url 'league_match_results' league_name=item.season.subleague.league.name subleague_name=item.season.subleague.subleague matchid=item.id %}">
                            {% if item.winner == team or item.winner == team  %}
                        <div>WIN ({{item.team1score}}-{{item.team2score}})</div>
                        {% else %}
                        <div>LOSE ({{item.team1score}}-{{item.team2score}})</div>
                        {% endif %}
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </table>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}